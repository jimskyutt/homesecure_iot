<!DOCTYPE html>
<html>
<head>
    <title>HomeSecure Control Panel</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            text-align: center;
            background-color: #f5f5f5;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 500px;
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
            font-size: 2em;
        }
        .btn {
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            margin: 10px;
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 160px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .btn:active {
            transform: scale(0.95);
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        .btn-on { 
            background-color: #4CAF50;
            box-shadow: 0 4px 0 #2E7D32;
        }
        .btn-off { 
            background-color: #f44336;
            box-shadow: 0 4px 0 #c62828;
        }
        .btn-alert {
            background-color: #FF9800;
            box-shadow: 0 4px 0 #F57C00;
        }
        .status {
            margin: 25px 0 15px;
            padding: 15px;
            border-radius: 8px;
            background-color: #f0f7ff;
            font-size: 18px;
        }
        .info {
            margin-top: 30px;
            font-size: 14px;
            color: #666;
        }
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: #fff;
            margin: 15% auto;
            padding: 25px;
            border-radius: 10px;
            width: 80%;
            max-width: 500px;
            text-align: center;
            animation: modalFadeIn 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        @keyframes modalFadeIn {
            from {opacity: 0; transform: translateY(-50px);}
            to {opacity: 1; transform: translateY(0);}
        }
        .modal h2 {
            color: #d32f2f;
            margin-top: 0;
        }
        .modal-buttons {
            margin: 25px 0 10px;
        }
        @media (max-width: 480px) {
            .container, .modal-content {
                padding: 15px;
                width: 90%;
            }
            .btn {
                width: 100%;
                margin: 8px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>HomeSecure</h1>
        
        <div class="control-panel">
            <div id="securityStatus" class="status">
                Security System: <span id="securityState">DISARMED</span>
            </div>
            
            <div>
                <button id="armBtn" class="btn btn-on">Arm System</button>
                <button id="disarmBtn" class="btn btn-off" disabled>Disarm System</button>
            </div>
            
            <div class="status" id="alarmStatus">
                Alarm: <span id="alarmState">INACTIVE</span>
            </div>
            
            <div>
                <button id="testAlarmBtn" class="btn btn-alert">Test Alarm</button>
            </div>
        </div>
        
        <div class="info">
            <p>Status: <span id="connectionStatus">Connecting...</span></p>
            <p>Last updated: <span id="lastUpdated">Never</span></p>
        </div>
    </div>

    <!-- Motion Detected Modal -->
    <div id="motionModal" class="modal">
        <div class="modal-content">
            <h2>ðŸš¨ Motion Detected!</h2>
            <p>Possible intrusion detected at your property.</p>
            <p><strong>Activate HomeSecure alarm?</strong></p>
            <p><small>This will sound the alarm and notify authorities if configured.</small></p>
            <div class="modal-buttons">
                <button id="confirmAlarm" class="btn btn-alert" style="margin-right: 10px;">ACTIVATE ALARM</button>
                <button id="dismissAlarm" class="btn btn-off">DISMISS</button>
            </div>
            <p id="countdown" style="margin: 10px 0 0; font-size: 0.9em; color: #666;">
                Auto-dismiss in <span id="countdownNumber">30</span>s
            </p>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDkXq_9bLX5xUY4gTzRkHhLdW9X8JvK9Yw",
            authDomain: "home-83fb6.firebaseapp.com",
            databaseURL: "https://home-83fb6-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "home-83fb6",
            storageBucket: "home-83fb6.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abc123def456"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const securityRef = database.ref('security');

        // DOM Elements
        const armBtn = document.getElementById('armBtn');
        const disarmBtn = document.getElementById('disarmBtn');
        const testAlarmBtn = document.getElementById('testAlarmBtn');
        const securityState = document.getElementById('securityState');
        const alarmState = document.getElementById('alarmState');
        const connectionStatus = document.getElementById('connectionStatus');
        const lastUpdated = document.getElementById('lastUpdated');
        const motionModal = document.getElementById('motionModal');
        const confirmAlarmBtn = document.getElementById('confirmAlarm');
        const dismissAlarmBtn = document.getElementById('dismissAlarm');
        const countdownElement = document.getElementById('countdownNumber');

        // Variables
        let countdown;
        let countdownValue = 30;

        // Update UI based on security state
        function updateSecurityUI(isArmed) {
            securityState.textContent = isArmed ? 'ARMED' : 'DISARMED';
            securityState.style.color = isArmed ? '#4CAF50' : '#f44336';
            armBtn.disabled = isArmed;
            disarmBtn.disabled = !isArmed;
            document.body.style.backgroundColor = isArmed ? '#fff8f8' : '#f5f5f5';
        }

        // Update UI based on alarm state
        function updateAlarmUI(isAlarmActive) {
            alarmState.textContent = isAlarmActive ? 'ACTIVE' : 'INACTIVE';
            alarmState.style.color = isAlarmActive ? '#f44336' : '#4CAF50';
            document.body.style.backgroundColor = isAlarmActive ? '#ffebee' : (securityState.textContent === 'ARMED' ? '#fff8f8' : '#f5f5f5');
        }

        // Show motion alert modal
        function showMotionAlert() {
            // Reset countdown
            countdownValue = 30;
            countdownElement.textContent = countdownValue;
            motionModal.style.display = 'block';
            
            // Start countdown
            clearInterval(countdown);
            countdown = setInterval(() => {
                countdownValue--;
                countdownElement.textContent = countdownValue;
                
                if (countdownValue <= 0) {
                    clearInterval(countdown);
                    motionModal.style.display = 'none';
                    securityRef.update({ motionDetected: false });
                }
            }, 1000);
        }

        // Update last updated time
        function updateLastUpdated() {
            const now = new Date();
            lastUpdated.textContent = now.toLocaleTimeString();
        }

        // Event Listeners
        armBtn.addEventListener('click', () => {
            securityRef.update({ 
                armed: true,
                alarm: false,
                motionDetected: false
            });
        });

        disarmBtn.addEventListener('click', () => {
            securityRef.update({ 
                armed: false,
                alarm: false,
                motionDetected: false
            });
        });

        testAlarmBtn.addEventListener('click', () => {
            const isArmed = securityState.textContent === 'ARMED';
            if (isArmed) {
                if (confirm('Test the alarm? This will sound the siren for 5 seconds.')) {
                    // Set test mode in Firebase
                    database.ref('testMode').set(true);
                    
                    // Turn on alarm for 5 seconds
                    securityRef.update({ alarm: true });
                    setTimeout(() => {
                        securityRef.update({ alarm: false });
                        database.ref('testMode').set(false);
                    }, 5000);
                }
            } else {
                alert('Please arm the system first before testing.');
            }
        });

        confirmAlarmBtn.addEventListener('click', () => {
            securityRef.update({
                alarm: true,
                motionDetected: false
            });
            motionModal.style.display = 'none';
            clearInterval(countdown);
        });

        dismissAlarmBtn.addEventListener('click', () => {
            securityRef.update({ motionDetected: false });
            motionModal.style.display = 'none';
            clearInterval(countdown);
        });

        // Firebase Listeners
        securityRef.child('armed').on('value', (snapshot) => {
            const isArmed = snapshot.val() || false;
            updateSecurityUI(isArmed);
            updateLastUpdated();
        });

        securityRef.child('alarm').on('value', (snapshot) => {
            const isAlarmActive = snapshot.val() || false;
            updateAlarmUI(isAlarmActive);
            updateLastUpdated();
        });

        securityRef.child('motionDetected').on('value', (snapshot) => {
            const motionDetected = snapshot.val() || false;
            if (motionDetected && securityState.textContent === 'ARMED') {
                showMotionAlert();
            }
        });

        // Connection monitoring
        database.ref('.info/connected').on('value', (snapshot) => {
            const isConnected = snapshot.val();
            connectionStatus.textContent = isConnected ? 'Connected to Firebase' : 'Disconnected';
            connectionStatus.style.color = isConnected ? '#4CAF50' : '#f44336';
            
            if (isConnected) {
                updateLastUpdated();
            }
        });

        // Initial UI update
        updateSecurityUI(false);
        updateAlarmUI(false);
    </script>
</body>
</html>
